<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="mobile-web-app-capable" content="yes"/>
<meta name="theme-color" content="#1a0a10"/>
<link rel="apple-touch-icon" id="pwa-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%231a0a10' width='100' height='100' rx='22'/><text x='50' y='68' text-anchor='middle' font-size='50'>ğŸ’‹</text></svg>"/>
<link rel="manifest" id="pwa-manifest"/>
<title>ğŸ’‹</title>
<style>html,body,#root{margin:0;padding:0;height:100%;width:100%;overflow:hidden;}</style>
<script>
// Dynamic PWA manifest
const manifestData={name:"ğŸ’‹",short_name:"ğŸ’‹",start_url:window.location.href,display:"standalone",background_color:"#1a0a10",theme_color:"#ff2d6f",icons:[{src:"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect fill='%231a0a10' width='512' height='512' rx='112'/><text x='256' y='350' text-anchor='middle' font-size='280'>ğŸ’‹</text></svg>",sizes:"512x512",type:"image/svg+xml"}]};
const blob=new Blob([JSON.stringify(manifestData)],{type:'application/json'});
document.getElementById('pwa-manifest').href=URL.createObjectURL(blob);
// Service Worker for offline + caching
if('serviceWorker' in navigator){
  const swCode=`self.addEventListener('install',e=>self.skipWaiting());self.addEventListener('activate',e=>e.waitUntil(self.clients.claim()));self.addEventListener('fetch',e=>{if(e.request.url.includes('supabase'))return;e.respondWith(fetch(e.request).catch(()=>caches.match(e.request)));});`;
  const swBlob=new Blob([swCode],{type:'application/javascript'});
  navigator.serviceWorker.register(URL.createObjectURL(swBlob)).catch(()=>{});
}
</script>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script type="text/babel">
const{useState,useEffect,useRef,useMemo,useCallback}=React;
const SB_URL='https://yyffzdygxrvdjrgvsiiu.supabase.co';
const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl5ZmZ6ZHlneHJ2ZGpyZ3ZzaWl1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2ODEzNjcsImV4cCI6MjA4NjI1NzM2N30.qYYfXRAD6UYrXs19zQwKYVsVz09YedCnaKTsyUp7itI';
const sb=window.supabase.createClient(SB_URL,SB_KEY);
const gid=()=>Math.random().toString(36).substr(2,9);
const today=()=>new Date().toISOString().split("T")[0];
const inRanges=(ds,R)=>{if(!R||!R.length)return false;const d=new Date(ds+"T12:00:00");return R.some(r=>{const s=new Date(r.start+"T00:00:00"),e=new Date((r.end||r.start)+"T23:59:59");return d>=s&&d<=e;});};
const COMMON_EMOJI=["ğŸ“","ğŸ“¸","â¤ï¸","ğŸ”¥","ğŸ’‹","ğŸ˜ˆ","â›“ï¸","ğŸ–¤","ğŸ’œ","ğŸ’•","ğŸŒ¹","ğŸ•¯ï¸","ğŸ­","ğŸ‘","ğŸ‘…","ğŸ”’","ğŸ’","âœ¨","ğŸŒ™","ğŸ","ğŸ‘™","ğŸ†","ğŸ’¦","ğŸ¦‹","ğŸ","ğŸ·","ğŸµ","ğŸ’«","ğŸ«¦","ğŸª¢"];
const THEMES={
valentines:{name:"Valentine's Kiss",emoji:"ğŸ’‹",bg:"linear-gradient(135deg,#1a0a10 0%,#2d0a1e 40%,#1a0a10 100%)",card:"rgba(60,15,35,0.7)",cardBorder:"rgba(255,70,120,0.15)",primary:"#ff2d6f",primaryGlow:"rgba(255,45,111,0.3)",secondary:"#ff6b9d",text:"#fff0f5",textMuted:"#c9899e",surface:"rgba(80,20,45,0.5)",inputBg:"rgba(40,10,25,0.8)",inputBorder:"rgba(255,70,120,0.25)",danger:"#ff4466",success:"#4ecdc4",warning:"#ffa62b",headerBg:"rgba(30,5,18,0.95)",navBg:"rgba(30,5,18,0.98)",glow:"0 0 40px rgba(255,45,111,0.15)",pattern:"radial-gradient(circle at 20% 80%,rgba(255,45,111,0.06) 0%,transparent 50%)"},
neonDungeon:{name:"Neon Dungeon",emoji:"â›“ï¸",bg:"linear-gradient(180deg,#050508 0%,#0a0515 50%,#080010 100%)",card:"rgba(15,5,35,0.85)",cardBorder:"rgba(180,0,255,0.2)",primary:"#b400ff",primaryGlow:"rgba(180,0,255,0.35)",secondary:"#e040fb",text:"#f0e4ff",textMuted:"#8866aa",surface:"rgba(30,10,60,0.6)",inputBg:"rgba(10,2,25,0.9)",inputBorder:"rgba(180,0,255,0.3)",danger:"#ff2244",success:"#00ff88",warning:"#ffaa00",headerBg:"rgba(5,2,15,0.97)",navBg:"rgba(5,2,15,0.98)",glow:"0 0 60px rgba(180,0,255,0.2)",pattern:"radial-gradient(ellipse at 50% 0%,rgba(180,0,255,0.08) 0%,transparent 60%)"},
redRoom:{name:"Red Room",emoji:"ğŸ”´",bg:"linear-gradient(160deg,#0c0404 0%,#1a0808 30%,#0c0404 100%)",card:"rgba(50,10,10,0.8)",cardBorder:"rgba(180,20,20,0.2)",primary:"#cc1111",primaryGlow:"rgba(200,20,20,0.3)",secondary:"#ff3333",text:"#ffe8e8",textMuted:"#aa6666",surface:"rgba(60,12,12,0.6)",inputBg:"rgba(25,5,5,0.9)",inputBorder:"rgba(180,20,20,0.3)",danger:"#ff3333",success:"#44cc88",warning:"#ffaa33",headerBg:"rgba(10,3,3,0.97)",navBg:"rgba(10,3,3,0.98)",glow:"0 0 50px rgba(200,20,20,0.15)",pattern:"radial-gradient(circle at 50% 50%,rgba(200,20,20,0.04) 0%,transparent 70%)"},
blackLatex:{name:"Black Latex",emoji:"ğŸ–¤",bg:"linear-gradient(135deg,#030305 0%,#08080c 40%,#030305 100%)",card:"rgba(15,15,25,0.85)",cardBorder:"rgba(0,200,255,0.12)",primary:"#00ccff",primaryGlow:"rgba(0,200,255,0.25)",secondary:"#44ddff",text:"#e8f4ff",textMuted:"#6688aa",surface:"rgba(10,15,30,0.7)",inputBg:"rgba(5,5,15,0.9)",inputBorder:"rgba(0,200,255,0.2)",danger:"#ff3355",success:"#00ff99",warning:"#ffcc00",headerBg:"rgba(3,3,8,0.97)",navBg:"rgba(3,3,8,0.98)",glow:"0 0 40px rgba(0,200,255,0.1)",pattern:"radial-gradient(circle at 15% 85%,rgba(0,200,255,0.04) 0%,transparent 40%)"},
goldenBondage:{name:"Golden Chains",emoji:"ğŸ‘‘",bg:"linear-gradient(135deg,#060604 0%,#0e0c06 40%,#060604 100%)",card:"rgba(30,25,10,0.8)",cardBorder:"rgba(218,165,32,0.18)",primary:"#daa520",primaryGlow:"rgba(218,165,32,0.25)",secondary:"#f0c850",text:"#fff8e8",textMuted:"#a89870",surface:"rgba(40,32,12,0.6)",inputBg:"rgba(18,14,4,0.9)",inputBorder:"rgba(218,165,32,0.25)",danger:"#ff4466",success:"#4ecdc4",warning:"#ffa62b",headerBg:"rgba(6,5,2,0.97)",navBg:"rgba(6,5,2,0.98)",glow:"0 0 50px rgba(218,165,32,0.12)",pattern:"radial-gradient(circle at 20% 80%,rgba(218,165,32,0.04) 0%,transparent 50%)"},
};
const TIME_SLOTS=[{id:"morning",label:"Morning",icon:"ğŸŒ…"},{id:"afternoon",label:"Afternoon",icon:"â˜€ï¸"},{id:"evening",label:"Evening",icon:"ğŸŒ†"},{id:"night",label:"Night",icon:"ğŸŒ™"}];
const SERVICE_TYPES=[{id:"bj",label:"Blow Job",icon:"ğŸ‘…",color:"#ff6b9d"},{id:"sex",label:"Sex",icon:"ğŸ”¥",color:"#ff2d6f"},{id:"both",label:"Full Service",icon:"ğŸ’‹",color:"#a050ff"}];
const VIBES=[{id:"relaxing",label:"Relaxing",icon:"ğŸ§˜"},{id:"rough",label:"Rough",icon:"â›“ï¸"},{id:"slow",label:"Slow & Sensual",icon:"ğŸ•¯ï¸"},{id:"quickie",label:"Quickie",icon:"âš¡"},{id:"romantic",label:"Romantic",icon:"ğŸŒ¹"},{id:"kinky",label:"Extra Kinky",icon:"ğŸ˜ˆ"},{id:"surprise",label:"Surprise Me",icon:"ğŸ"},{id:"marathon",label:"Marathon",icon:"ğŸ†"}];
const ADDON_OPTIONS=[{id:"massage",label:"Pre-Massage",icon:"ğŸ’†"},{id:"blindfold",label:"Blindfold",icon:"ğŸ™ˆ"},{id:"music",label:"Mood Music",icon:"ğŸµ"},{id:"candles",label:"Candles",icon:"ğŸ•¯ï¸"},{id:"lingerie",label:"Special Outfit",icon:"ğŸ‘™"},{id:"food",label:"Snacks & Wine",icon:"ğŸ·"},{id:"toys",label:"Toys",icon:"ğŸ²"},{id:"buttplug",label:"Butt Plug",icon:"ğŸ‘"}];
const KINKY_EXTRAS=[{id:"vpump",label:"V-Pump",icon:"ğŸ’¨"},{id:"facefuck",label:"Face Fuck",icon:"ğŸ˜µ"},{id:"bondage",label:"Bondage",icon:"ğŸª¢"},{id:"spanking",label:"Spanking | Paddling | Flogging",icon:"ğŸ"},{id:"edgeplay",label:"Edge Play",icon:"ğŸ”ª"},{id:"anal",label:"Anal",icon:"ğŸ‘"}];
const getStyles=(t)=>`
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800&family=Nunito:wght@300;400;500;600;700&display=swap');
*{box-sizing:border-box;margin:0;padding:0}html,body,#root{height:100%;width:100%;overflow:hidden}body{font-family:'Nunito',sans-serif;background:${t.bg};color:${t.text};-webkit-font-smoothing:antialiased}
.app-container{height:100vh;width:100vw;display:flex;flex-direction:column;background:${t.bg};position:relative;overflow:hidden}.app-container::before{content:'';position:absolute;inset:0;background:${t.pattern};pointer-events:none;z-index:0}
.header{background:${t.headerBg};backdrop-filter:blur(20px);border-bottom:1px solid ${t.cardBorder};padding:11px 16px;display:flex;align-items:center;justify-content:space-between;z-index:100;position:relative;box-shadow:${t.glow}}
.header h1{font-family:'Playfair Display',serif;font-size:1.15rem;font-weight:700;background:linear-gradient(135deg,${t.primary},${t.secondary});-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.header-right{display:flex;gap:6px;align-items:center}.header-msg-btn{background:none;border:none;font-size:1.1rem;cursor:pointer;position:relative;padding:4px;border-radius:8px;transition:all 0.2s}.msg-dot{position:absolute;top:0;right:0;width:8px;height:8px;border-radius:50%;background:${t.danger}}
.main-content{flex:1;overflow-y:auto;overflow-x:hidden;padding:16px;padding-bottom:85px;z-index:1;position:relative;scrollbar-width:thin;scrollbar-color:${t.primary}33 transparent}.main-content::-webkit-scrollbar{width:4px}.main-content::-webkit-scrollbar-thumb{background:${t.primary}33;border-radius:4px}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:${t.navBg};backdrop-filter:blur(20px);border-top:1px solid ${t.cardBorder};display:flex;justify-content:space-around;padding:5px 0 max(5px,env(safe-area-inset-bottom));z-index:100}
.nav-item{display:flex;flex-direction:column;align-items:center;gap:1px;padding:4px 6px;background:none;border:none;color:${t.textMuted};cursor:pointer;transition:all 0.2s;font-size:0.58rem;font-family:'Nunito',sans-serif;font-weight:600;border-radius:10px;position:relative}.nav-item.active{color:${t.primary};background:${t.primaryGlow}}.nav-item .nav-icon{font-size:1.1rem;line-height:1}.nav-dot{position:absolute;top:1px;right:4px;width:6px;height:6px;border-radius:50%;background:${t.danger}}
.card{background:${t.card};border:1px solid ${t.cardBorder};border-radius:14px;padding:16px;margin-bottom:12px;backdrop-filter:blur(10px);transition:all 0.3s ease}.card-title{font-family:'Playfair Display',serif;font-size:1rem;font-weight:700;margin-bottom:10px;color:${t.text}}
.btn{padding:9px 18px;border-radius:11px;border:none;cursor:pointer;font-weight:600;font-family:'Nunito',sans-serif;font-size:0.88rem;transition:all 0.25s ease;display:inline-flex;align-items:center;gap:7px;justify-content:center}
.btn-primary{background:linear-gradient(135deg,${t.primary},${t.secondary});color:white;box-shadow:0 4px 15px ${t.primaryGlow}}.btn-secondary{background:${t.surface};color:${t.text};border:1px solid ${t.cardBorder}}.btn-danger{background:${t.danger}22;color:${t.danger};border:1px solid ${t.danger}33}
.btn-sm{padding:5px 12px;font-size:0.78rem;border-radius:8px}.btn-block{width:100%}.btn:disabled{opacity:0.5;cursor:not-allowed}
input[type="text"],input[type="password"],input[type="email"],input[type="tel"],input[type="date"],textarea,select{width:100%;padding:10px 13px;background:${t.inputBg};border:1px solid ${t.inputBorder};border-radius:11px;color:${t.text};font-family:'Nunito',sans-serif;font-size:0.88rem;outline:none}input:focus,textarea:focus{border-color:${t.primary}}input[type="color"]{width:42px;height:42px;padding:3px;border-radius:10px;cursor:pointer;background:${t.inputBg};border:1px solid ${t.inputBorder}}textarea{resize:vertical;min-height:65px}label{display:block;margin-bottom:4px;font-weight:600;font-size:0.8rem;color:${t.textMuted}}.form-group{margin-bottom:13px}.form-row{display:flex;gap:8px}.form-row>*{flex:1}
.chip-grid{display:flex;flex-wrap:wrap;gap:6px}.chip{padding:6px 11px;border-radius:9px;background:${t.surface};border:1px solid ${t.cardBorder};cursor:pointer;transition:all 0.2s;font-size:0.78rem;font-weight:500;display:flex;align-items:center;gap:5px;color:${t.textMuted}}.chip.selected{background:${t.primaryGlow};border-color:${t.primary};color:${t.text}}
.badge{display:inline-block;padding:2px 9px;border-radius:20px;font-size:0.66rem;font-weight:700;text-transform:uppercase}.badge-upcoming{background:${t.success}22;color:${t.success}}.badge-cancelled,.badge-rejected{background:${t.danger}22;color:${t.danger}}.badge-pending{background:${t.warning}22;color:${t.warning}}
.section-title{font-family:'Playfair Display',serif;font-size:1.35rem;font-weight:800;margin-bottom:3px;background:linear-gradient(135deg,${t.primary},${t.secondary});-webkit-background-clip:text;-webkit-text-fill-color:transparent}.section-subtitle{color:${t.textMuted};font-size:0.8rem;margin-bottom:16px}
.login-container{height:100vh;width:100vw;display:flex;align-items:center;justify-content:center;background:${t.bg};position:relative;overflow:hidden}.login-container::before{content:'';position:absolute;inset:0;background:${t.pattern};pointer-events:none}
.login-box{background:${t.card};border:1px solid ${t.cardBorder};border-radius:24px;padding:34px;max-width:370px;width:90%;backdrop-filter:blur(20px);z-index:1;box-shadow:${t.glow};animation:fadeUp 0.6s ease}
.login-title{font-family:'Playfair Display',serif;font-size:1.9rem;text-align:center;margin-bottom:3px;background:linear-gradient(135deg,${t.primary},${t.secondary});-webkit-background-clip:text;-webkit-text-fill-color:transparent}.login-sub{text-align:center;color:${t.textMuted};font-size:0.83rem;margin-bottom:22px}.login-emoji{text-align:center;font-size:2.8rem;margin-bottom:10px;animation:pulse 2s infinite}
.photo-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:5px}.photo-thumb{aspect-ratio:1;border-radius:9px;background:${t.surface};overflow:hidden;cursor:pointer;border:1px solid ${t.cardBorder};transition:all 0.2s;position:relative}.photo-thumb img,.photo-thumb video{width:100%;height:100%;object-fit:cover}.photo-thumb .del-btn{position:absolute;top:3px;right:3px;background:${t.danger}cc;color:white;border:none;border-radius:50%;width:20px;height:20px;cursor:pointer;font-size:0.6rem;display:none;align-items:center;justify-content:center}.photo-thumb:hover .del-btn{display:flex}
.appointment-card{border-left:3px solid ${t.primary};padding-left:13px}.appointment-card.cancelled{border-left-color:${t.danger};opacity:0.7}
.toggle-track{width:40px;height:22px;border-radius:11px;background:${t.surface};border:1px solid ${t.cardBorder};cursor:pointer;position:relative;transition:all 0.3s;flex-shrink:0}.toggle-track.active{background:${t.primary};border-color:${t.primary}}.toggle-knob{width:16px;height:16px;border-radius:50%;background:white;position:absolute;top:2px;left:2px;transition:all 0.3s}.toggle-track.active .toggle-knob{left:20px}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.75);display:flex;align-items:center;justify-content:center;z-index:1000;backdrop-filter:blur(4px)}.modal-content{background:${t.card};border:1px solid ${t.cardBorder};border-radius:18px;padding:22px;max-width:460px;width:92%;max-height:85vh;overflow-y:auto;animation:fadeUp 0.3s ease;backdrop-filter:blur(20px)}
.stats-row{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:13px}.stat-card{background:${t.surface};border-radius:12px;padding:13px;text-align:center;border:1px solid ${t.cardBorder}}.stat-number{font-family:'Playfair Display',serif;font-size:1.4rem;font-weight:800;color:${t.primary}}.stat-label{font-size:0.65rem;color:${t.textMuted};font-weight:600}
.theme-option{display:flex;align-items:center;gap:10px;padding:9px 12px;border-radius:11px;cursor:pointer;border:2px solid transparent;background:${t.surface};margin-bottom:6px}.theme-option.selected{border-color:${t.primary};background:${t.primaryGlow}}.theme-dot{width:28px;height:28px;border-radius:50%;flex-shrink:0}
.empty-state{text-align:center;padding:32px 16px;color:${t.textMuted}}.empty-state .empty-icon{font-size:2.2rem;margin-bottom:8px}
.floating-hearts{position:absolute;inset:0;pointer-events:none;overflow:hidden;z-index:0}.heart-float{position:absolute;font-size:1.1rem;opacity:0.06;animation:floatUp 8s linear infinite}
.chat-container{display:flex;flex-direction:column;height:calc(100vh - 128px)}.chat-messages{flex:1;overflow-y:auto;padding:4px 0;display:flex;flex-direction:column;gap:5px}
.chat-msg{max-width:80%;padding:9px 13px;border-radius:14px;font-size:0.86rem;line-height:1.4;word-wrap:break-word}.chat-msg.sent{align-self:flex-end;background:linear-gradient(135deg,${t.primary},${t.secondary});color:white;border-bottom-right-radius:4px}.chat-msg.received{align-self:flex-start;background:${t.surface};border:1px solid ${t.cardBorder};border-bottom-left-radius:4px}.chat-msg .msg-time{font-size:0.62rem;opacity:0.55;margin-top:3px;display:block;text-align:right}
.chat-input-area{padding-top:8px;border-top:1px solid ${t.cardBorder};display:flex;flex-direction:column;gap:6px}.chat-input-row{display:flex;gap:6px}.chat-input-row input{flex:1}
.chat-notify-row{display:flex;gap:10px}.chat-notify-row label{display:flex;align-items:center;gap:4px;font-size:0.72rem;color:${t.textMuted};cursor:pointer;margin-bottom:0;font-weight:500}.chat-notify-row input[type="checkbox"]{width:15px;height:15px;accent-color:${t.primary};padding:0}
.dr-pill{display:inline-flex;align-items:center;gap:5px;padding:4px 9px;border-radius:7px;background:${t.surface};border:1px solid ${t.cardBorder};font-size:0.72rem;margin:2px}.dr-pill button{background:none;border:none;color:${t.danger};cursor:pointer;font-size:0.75rem}
.profile-avatar{width:68px;height:68px;border-radius:50%;background:linear-gradient(135deg,${t.primary},${t.secondary});display:flex;align-items:center;justify-content:center;font-size:1.7rem;margin:0 auto 12px;border:3px solid ${t.primary}44;overflow:hidden;cursor:pointer;transition:all 0.3s}.profile-avatar img{width:100%;height:100%;object-fit:cover}
.lightbox{position:fixed;inset:0;background:rgba(0,0,0,0.95);display:flex;align-items:center;justify-content:center;z-index:2000;cursor:pointer}.lightbox img,.lightbox video{max-width:95vw;max-height:90vh;object-fit:contain;border-radius:8px}.lightbox-close{position:absolute;top:14px;right:14px;background:none;border:none;color:white;font-size:1.8rem;cursor:pointer}
.setting-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid ${t.cardBorder}}.setting-row:last-child{border-bottom:none}.setting-label{font-weight:600;font-size:0.86rem}.setting-desc{font-size:0.7rem;color:${t.textMuted}}
.toast{position:fixed;top:70px;left:50%;transform:translateX(-50%);padding:10px 20px;border-radius:12px;font-size:0.82rem;font-weight:600;z-index:3000;animation:fadeUp 0.3s ease}.toast-success{background:${t.success}dd;color:white}.toast-error{background:${t.danger}dd;color:white}
.loading-screen{height:100vh;width:100vw;display:flex;align-items:center;justify-content:center;background:${t.bg};flex-direction:column;gap:12px}.spinner{width:36px;height:36px;border:3px solid ${t.cardBorder};border-top-color:${t.primary};border-radius:50%;animation:spin 0.8s linear infinite}
.tab-bar{display:flex;gap:0;margin-bottom:12px;border-radius:10px;overflow:hidden;border:1px solid ${t.cardBorder}}.tab-btn{flex:1;padding:8px;text-align:center;font-size:0.82rem;font-weight:600;cursor:pointer;background:${t.surface};color:${t.textMuted};border:none;font-family:'Nunito',sans-serif;transition:all 0.2s}.tab-btn.active{background:${t.primaryGlow};color:${t.text};border-bottom:2px solid ${t.primary}}
.emoji-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:6px;margin:8px 0}.emoji-btn{padding:6px;border-radius:8px;background:${t.surface};border:1px solid ${t.cardBorder};cursor:pointer;font-size:1.3rem;text-align:center;transition:all 0.15s}.emoji-btn:hover,.emoji-btn.sel{border-color:${t.primary};background:${t.primaryGlow}}
.img-gallery{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}.img-gallery-item{aspect-ratio:1;border-radius:10px;overflow:hidden;cursor:pointer;border:2px solid transparent;transition:all 0.2s;position:relative}.img-gallery-item.sel{border-color:${t.primary};box-shadow:0 0 12px ${t.primaryGlow}}.img-gallery-item img{width:100%;height:100%;object-fit:cover}.img-gallery-item .del-x{position:absolute;top:3px;right:3px;background:${t.danger}cc;color:white;border:none;border-radius:50%;width:18px;height:18px;font-size:0.55rem;cursor:pointer;display:none;align-items:center;justify-content:center}.img-gallery-item:hover .del-x{display:flex}
@keyframes spin{to{transform:rotate(360deg)}}@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}@keyframes floatUp{0%{transform:translateY(100vh) rotate(0deg);opacity:0}10%{opacity:0.06}90%{opacity:0.06}100%{transform:translateY(-10vh) rotate(360deg);opacity:0}}
.stagger-1{animation:fadeUp 0.35s ease 0.04s both}.stagger-2{animation:fadeUp 0.35s ease 0.08s both}.stagger-3{animation:fadeUp 0.35s ease 0.12s both}.stagger-4{animation:fadeUp 0.35s ease 0.16s both}.stagger-5{animation:fadeUp 0.35s ease 0.2s both}
@media(min-width:768px){.main-content{max-width:580px;margin:0 auto}.photo-grid{grid-template-columns:repeat(4,1fr)}}`;
const FloatingHearts=()=>{const h=["ğŸ’‹","â¤ï¸","ğŸ’•","ğŸ”¥","ğŸ’œ","âœ¨","ğŸ’—","ğŸ˜ˆ","â›“ï¸","ğŸ–¤"];return(<div className="floating-hearts">{Array.from({length:10}).map((_,i)=>(<span key={i} className="heart-float" style={{left:`${(i*10+3)%100}%`,animationDelay:`${i*0.8}s`,animationDuration:`${6+(i%4)*2}s`,fontSize:`${0.8+(i%3)*0.25}rem`}}>{h[i%h.length]}</span>))}</div>);};
const Toggle=({active,onToggle})=>(<div className={`toggle-track ${active?"active":""}`} onClick={onToggle}><div className="toggle-knob"/></div>);
function App(){
const[session,setSession]=useState(null);const[profile,setProfile]=useState(null);const[partner,setPartner]=useState(null);const[appLoading,setAppLoading]=useState(true);
const[authMode,setAuthMode]=useState("login");const[authForm,setAuthForm]=useState({email:"",password:"",displayName:"",role:"user"});const[authError,setAuthError]=useState("");const[authBusy,setAuthBusy]=useState(false);
const[page,setPage]=useState("home");const[appointments,setAppointments]=useState([]);const[messages,setMessages]=useState([]);const[photos,setPhotos]=useState([]);const[photoFolders,setPhotoFolders]=useState([]);const[openFolder,setOpenFolder]=useState(null);const[vaultTab,setVaultTab]=useState("shared");
const[settings,setSettings]=useState({current_theme:"valentines",custom_colors:null,restrict_dates:false,restricted_date_ranges:[],anal_date_ranges:[]});
const[prefs,setPrefs]=useState({app_name:"ğŸ’‹",app_icon_type:"theme",app_icon_image_path:"",app_icon_theme:"valentines",bg_image_path:""});
const[custImages,setCustImages]=useState([]);
const[showModal,setShowModal]=useState(null);const[lightboxPhoto,setLightboxPhoto]=useState(null);const[toast,setToast]=useState(null);
const[historyFilterFrom,setHistoryFilterFrom]=useState("");const[historyFilterTo,setHistoryFilterTo]=useState("");const[historySearch,setHistorySearch]=useState("");
const[historyFilters,setHistoryFilters]=useState({service:[],vibe:[],status:[],addons:[],kinkyExtras:[]});
const photoInputRef=useRef(null);const profileInputRef=useRef(null);const chatEndRef=useRef(null);const folderIconRef=useRef(null);const custImgRef=useRef(null);
const isAdmin=profile?.role==="admin";const currentTheme=settings.current_theme||"valentines";const customColors=settings.custom_colors;
const theme=THEMES[currentTheme]||THEMES.valentines;
const activeTheme=useMemo(()=>{let t={...theme};if(customColors){t.primary=customColors.primary;t.secondary=customColors.secondary;t.primaryGlow=customColors.primary+"4d";}return t;},[theme,customColors]);
useEffect(()=>{const id="app-styles";let el=document.getElementById(id);if(!el){el=document.createElement("style");el.id=id;document.head.appendChild(el);}el.textContent=getStyles(activeTheme);},[activeTheme]);
// Update PWA title
useEffect(()=>{document.title=prefs.app_name||"ğŸ’‹";},[prefs.app_name]);
const showToast=(msg,type="success")=>{setToast({msg,type});setTimeout(()=>setToast(null),3000);};
// Auth
useEffect(()=>{sb.auth.getSession().then(({data:{session:s}})=>{setSession(s);if(s)loadAll(s.user.id);else setAppLoading(false);});const{data:{subscription}}=sb.auth.onAuthStateChange((_ev,s)=>{setSession(s);if(s)loadAll(s.user.id);else{setProfile(null);setPartner(null);setAppLoading(false);}});return()=>subscription.unsubscribe();},[]);
// Realtime
useEffect(()=>{if(!session)return;const ch=sb.channel('rt').on('postgres_changes',{event:'*',schema:'public',table:'appointments'},()=>ldAppts()).on('postgres_changes',{event:'*',schema:'public',table:'messages'},()=>ldMsgs()).on('postgres_changes',{event:'*',schema:'public',table:'photos'},()=>ldPhotos()).on('postgres_changes',{event:'*',schema:'public',table:'photo_folders'},()=>ldFolders()).on('postgres_changes',{event:'*',schema:'public',table:'app_settings'},()=>ldSettings()).on('postgres_changes',{event:'*',schema:'public',table:'profiles'},()=>{ldProfile(session.user.id);ldPartner(session.user.id);}).subscribe();return()=>{sb.removeChannel(ch);};},[session]);
// Data loaders
const loadAll=async(uid)=>{try{await Promise.all([ldProfile(uid),ldPartner(uid),ldAppts(),ldMsgs(),ldPhotos(),ldFolders(),ldSettings(),ldPrefs(uid),ldCustImgs()]);}catch(e){console.error(e);}setAppLoading(false);};
const ldProfile=async(uid)=>{const{data}=await sb.from('profiles').select('*').eq('id',uid).single();if(data)setProfile(data);};
const ldPartner=async(uid)=>{const{data}=await sb.from('profiles').select('*').neq('id',uid);if(data?.length)setPartner(data[0]);};
const ldAppts=async()=>{const{data}=await sb.from('appointments').select('*').order('created_at',{ascending:false});setAppointments(data||[]);};
const ldMsgs=async()=>{const{data}=await sb.from('messages').select('*').order('created_at',{ascending:true});setMessages(data||[]);};
const ldFolders=async()=>{const{data}=await sb.from('photo_folders').select('*').order('created_at');setPhotoFolders(data||[]);};
const ldSettings=async()=>{const{data}=await sb.from('app_settings').select('*').eq('id',1).single();if(data)setSettings(data);};
const ldPrefs=async(uid)=>{const{data}=await sb.from('user_preferences').select('*').eq('user_id',uid||session?.user?.id).single();if(data)setPrefs(data);};
const ldCustImgs=async()=>{const{data:recs}=await sb.from('customization_images').select('*').order('created_at');if(!recs||!recs.length){setCustImages([]);return;}const paths=recs.map(r=>r.storage_path);const{data:urls}=await sb.storage.from('customizations').createSignedUrls(paths,3600);setCustImages(recs.map((r,i)=>({...r,url:urls?.[i]?.signedUrl||""})));};
const ldPhotos=async()=>{const{data:recs}=await sb.from('photos').select('*').order('created_at');if(!recs||!recs.length){setPhotos([]);return;}const paths=recs.map(p=>p.storage_path);const{data:urls}=await sb.storage.from('photos').createSignedUrls(paths,3600);setPhotos(recs.map((r,i)=>({...r,url:urls?.[i]?.signedUrl||""})));};
// Auth actions
const handleLogin=async()=>{setAuthBusy(true);setAuthError("");const{error}=await sb.auth.signInWithPassword({email:authForm.email,password:authForm.password});if(error)setAuthError(error.message);setAuthBusy(false);};
const handleSignup=async()=>{setAuthBusy(true);setAuthError("");if(!authForm.displayName.trim()){setAuthError("Display name required");setAuthBusy(false);return;}const{error}=await sb.auth.signUp({email:authForm.email,password:authForm.password,options:{data:{display_name:authForm.displayName.trim(),role:authForm.role}}});if(error)setAuthError(error.message);else showToast("Account created!");setAuthBusy(false);};
const handleLogout=async()=>{await sb.auth.signOut();setProfile(null);setPartner(null);setPage("home");};
// CRUD
const addAppt=async(a)=>{const st=isAdmin?"upcoming":"pending";await sb.from('appointments').insert({date:a.date,time_slot:a.timeSlot,service:a.service,vibe:a.vibe,addons:a.addons,kinky_extras:a.kinkyExtras,notes:a.notes,status:st,created_by:session.user.id});await ldAppts();setPage("home");showToast(isAdmin?"Booked! ğŸ’‹":"Request sent! â³");};
const cancelAppt=async(id,c)=>{await sb.from('appointments').update({status:"cancelled",cancel_comment:c||"",cancelled_at:new Date().toISOString()}).eq('id',id);await ldAppts();};
const deleteAppt=async(id)=>{await sb.from('appointments').delete().eq('id',id);await ldAppts();};
const approveAppt=async(id,msg)=>{await sb.from('appointments').update({status:"upcoming",admin_response:msg||"",responded_by:profile?.display_name||"",responded_at:new Date().toISOString()}).eq('id',id);await ldAppts();showToast("Accepted! ğŸ’‹");};
const rejectAppt=async(id,msg)=>{await sb.from('appointments').update({status:"rejected",admin_response:msg||"",responded_by:profile?.display_name||"",responded_at:new Date().toISOString()}).eq('id',id);await ldAppts();};
const sendMsg=async(text,n)=>{await sb.from('messages').insert({from_user:session.user.id,text,notify_email:n.email,notify_sms:n.sms,notify_app:n.app});await ldMsgs();};
// Photos
const uploadPhotos=async(files,scope="shared")=>{for(const f of files){const ext=f.name.split('.').pop();const ftype=f.type.startsWith('video/')?"video":"image";const path=`${session.user.id}/${Date.now()}_${gid()}.${ext}`;const{error}=await sb.storage.from('photos').upload(path,f);if(error){showToast("Upload failed","error");continue;}await sb.from('photos').insert({storage_path:path,file_name:f.name,file_type:ftype,folder_id:openFolder||null,scope,uploaded_by:session.user.id});}await ldPhotos();showToast("Uploaded! ğŸ“¸");};
const deletePhoto=async(p)=>{await sb.storage.from('photos').remove([p.storage_path]);await sb.from('photos').delete().eq('id',p.id);await ldPhotos();};
const handlePhotoInput=(e)=>{if(e.target.files?.length)uploadPhotos(Array.from(e.target.files),vaultTab);if(e.target)e.target.value="";};
// Folders
const createFolder=async(name,color,emoji,scope)=>{await sb.from('photo_folders').insert({name,color,emoji:emoji||"ğŸ“",scope:scope||vaultTab,created_by:session.user.id});await ldFolders();};
const updateFolder=async(id,u)=>{await sb.from('photo_folders').update(u).eq('id',id);await ldFolders();};
const deleteFolder=async(id)=>{await sb.from('photo_folders').delete().eq('id',id);await ldFolders();setOpenFolder(null);};
// Folder icon image upload
const uploadFolderIcon=async(file,folderId)=>{const ext=file.name.split('.').pop();const path=`folder-icons/${folderId}_${Date.now()}.${ext}`;const{error}=await sb.storage.from('customizations').upload(path,file);if(error){showToast("Upload failed","error");return;}const{data}=await sb.storage.from('customizations').createSignedUrl(path,86400*365);if(data?.signedUrl){await updateFolder(folderId,{icon_type:"image",icon_image_path:path});}};
const getFolderIconUrl=(folder)=>{if(folder.icon_type==="image"&&folder.icon_image_path){const ci=custImages.find(c=>c.storage_path===folder.icon_image_path);return ci?.url||"";}return "";};
// Profile
const updateProfile=async(u)=>{await sb.from('profiles').update({...u,updated_at:new Date().toISOString()}).eq('id',session.user.id);await ldProfile(session.user.id);};
const updatePartnerProfile=async(u)=>{if(!partner)return;await sb.from('profiles').update({...u,updated_at:new Date().toISOString()}).eq('id',partner.id);await ldPartner(session.user.id);};
const uploadAvatar=async(file)=>{const ext=file.name.split('.').pop();const path=`${session.user.id}/avatar.${ext}`;await sb.storage.from('avatars').upload(path,file,{upsert:true});const{data}=await sb.storage.from('avatars').createSignedUrl(path,86400*365);if(data?.signedUrl)await updateProfile({photo_url:data.signedUrl});};
// Settings
const updateSettings=async(u)=>{await sb.from('app_settings').update({...u,updated_at:new Date().toISOString()}).eq('id',1);await ldSettings();};
const updatePrefs=async(u)=>{await sb.from('user_preferences').update({...u,updated_at:new Date().toISOString()}).eq('user_id',session.user.id);await ldPrefs();};
// Customization images
const uploadCustImg=async(file,isPreset=false)=>{const ext=file.name.split('.').pop();const path=`${session.user.id}/${Date.now()}_${gid()}.${ext}`;const{error}=await sb.storage.from('customizations').upload(path,file);if(error){showToast("Upload failed","error");return;}await sb.from('customization_images').insert({storage_path:path,label:file.name,is_preset:isPreset,uploaded_by:session.user.id});await ldCustImgs();showToast("Image added!");};
const deleteCustImg=async(img)=>{await sb.storage.from('customizations').remove([img.storage_path]);await sb.from('customization_images').delete().eq('id',img.id);await ldCustImgs();};
const handleCustImgInput=(e)=>{if(e.target.files?.length){Array.from(e.target.files).forEach(f=>uploadCustImg(f));}if(e.target)e.target.value="";};
// Helpers
const isDateRestricted=(d)=>{if(!settings.restrict_dates||!settings.restricted_date_ranges?.length)return false;return!inRanges(d,settings.restricted_date_ranges);};
const isAnalAvailable=(d)=>settings.anal_date_ranges?.length>0&&inRanges(d,settings.anal_date_ranges);
const upcomingAppts=appointments.filter(a=>a.status==="upcoming").sort((a,b)=>new Date(a.date)-new Date(b.date));
const pendingAppts=appointments.filter(a=>a.status==="pending").sort((a,b)=>new Date(a.date)-new Date(b.date));
const unreadMsgs=messages.filter(m=>m.from_user!==session?.user?.id&&!m.read).length;
const scopedFolders=photoFolders.filter(f=>f.scope===vaultTab&&(vaultTab==="shared"||f.created_by===session?.user?.id));
const scopedPhotos=photos.filter(p=>p.scope===vaultTab&&(vaultTab==="shared"||p.uploaded_by===session?.user?.id));
const bgImageUrl=useMemo(()=>{if(!prefs.bg_image_path)return"";const ci=custImages.find(c=>c.storage_path===prefs.bg_image_path);return ci?.url||"";},[prefs.bg_image_path,custImages]);
if(appLoading)return(<div className="loading-screen"><FloatingHearts/><div className="spinner"/><div style={{color:"#c9899e",fontSize:"0.85rem"}}>Loading...</div></div>);
if(!session)return(<div className="login-container"><FloatingHearts/><div className="login-box"><div className="login-emoji">ğŸ’‹</div><h1 className="login-title">Book Me, Baby</h1><p className="login-sub">{authMode==="login"?"Welcome back, babe":"Create your account"}</p>
  {authMode==="signup"&&<><div className="form-group"><label>Display Name</label><input type="text" placeholder="e.g. Babe ğŸ‘‘" value={authForm.displayName} onChange={e=>setAuthForm(p=>({...p,displayName:e.target.value}))}/></div><div className="form-group"><label>Role</label><div className="chip-grid"><div className={`chip ${authForm.role==="admin"?"selected":""}`} onClick={()=>setAuthForm(p=>({...p,role:"admin"}))}><span>ğŸ‘‘</span><span>Admin</span></div><div className={`chip ${authForm.role==="user"?"selected":""}`} onClick={()=>setAuthForm(p=>({...p,role:"user"}))}><span>ğŸ’•</span><span>Partner</span></div></div></div></>}
  <div className="form-group"><label>Email</label><input type="email" placeholder="your@email.com" value={authForm.email} onChange={e=>setAuthForm(p=>({...p,email:e.target.value}))} onKeyDown={e=>e.key==="Enter"&&(authMode==="login"?handleLogin():handleSignup())}/></div>
  <div className="form-group"><label>Password</label><input type="password" placeholder="Enter password" value={authForm.password} onChange={e=>setAuthForm(p=>({...p,password:e.target.value}))} onKeyDown={e=>e.key==="Enter"&&(authMode==="login"?handleLogin():handleSignup())}/></div>
  {authError&&<p style={{color:"#ff4466",fontSize:"0.83rem",marginBottom:10,textAlign:"center"}}>{authError}</p>}
  <button className="btn btn-primary btn-block" onClick={authMode==="login"?handleLogin:handleSignup} disabled={authBusy} style={{marginTop:4}}>{authBusy?"...":(authMode==="login"?"Sign In ğŸ”¥":"Create Account ğŸ”¥")}</button>
  <p style={{textAlign:"center",marginTop:12,fontSize:"0.78rem"}}><span style={{color:"#c9899e"}}>{authMode==="login"?"No account? ":"Have one? "}</span><span style={{color:"#ff2d6f",cursor:"pointer",fontWeight:600}} onClick={()=>{setAuthMode(authMode==="login"?"signup":"login");setAuthError("");}}>{authMode==="login"?"Create Account":"Sign In"}</span></p></div></div>);
// Sub components
const BookingForm=({onSubmit,onCancel})=>{const[form,setForm]=useState({date:"",timeSlot:"",service:"",vibe:"",addons:[],kinkyExtras:[],notes:""});const tg=(k,id)=>setForm(p=>({...p,[k]:p[k].includes(id)?p[k].filter(x=>x!==id):[...p[k],id]}));const valid=form.date&&form.timeSlot&&form.service&&form.vibe&&!isDateRestricted(form.date);const showK=form.vibe==="kinky";const analOk=form.date&&isAnalAvailable(form.date);
  return(<div><div className="form-group stagger-1"><label>ğŸ“… Date</label><input type="date" value={form.date} min={today()} onChange={e=>{const v=e.target.value;if(!isDateRestricted(v))setForm(p=>({...p,date:v,kinkyExtras:p.kinkyExtras.filter(k=>k!=="anal")}));}}/></div>
  <div className="form-group stagger-2"><label>â° Time</label><div className="chip-grid">{TIME_SLOTS.map(s=><div key={s.id} className={`chip ${form.timeSlot===s.id?"selected":""}`} onClick={()=>setForm(p=>({...p,timeSlot:s.id}))}><span>{s.icon}</span><span>{s.label}</span></div>)}</div></div>
  <div className="form-group stagger-3"><label>ğŸ’‹ Service</label><div className="chip-grid">{SERVICE_TYPES.map(s=><div key={s.id} className={`chip ${form.service===s.id?"selected":""}`} onClick={()=>setForm(p=>({...p,service:s.id}))}><span>{s.icon}</span><span>{s.label}</span></div>)}</div></div>
  <div className="form-group stagger-4"><label>ğŸ­ Vibe</label><div className="chip-grid">{VIBES.map(v=><div key={v.id} className={`chip ${form.vibe===v.id?"selected":""}`} onClick={()=>setForm(p=>({...p,vibe:v.id,kinkyExtras:v.id!=="kinky"?[]:p.kinkyExtras}))}><span>{v.icon}</span><span>{v.label}</span></div>)}</div></div>
  {showK&&<div className="form-group"><label>ğŸ˜ˆ Kinky Extras</label><div className="chip-grid">{KINKY_EXTRAS.filter(k=>k.id!=="anal"||analOk).map(k=><div key={k.id} className={`chip ${form.kinkyExtras.includes(k.id)?"selected":""}`} onClick={()=>tg("kinkyExtras",k.id)}><span>{k.icon}</span><span>{k.label}</span></div>)}</div></div>}
  <div className="form-group stagger-5"><label>âœ¨ Add-ons</label><div className="chip-grid">{ADDON_OPTIONS.map(a=><div key={a.id} className={`chip ${form.addons.includes(a.id)?"selected":""}`} onClick={()=>tg("addons",a.id)}><span>{a.icon}</span><span>{a.label}</span></div>)}</div></div>
  <div className="form-group stagger-5"><label>ğŸ’¬ Notes</label><textarea placeholder="Anything specific? ğŸ˜" value={form.notes} onChange={e=>setForm(p=>({...p,notes:e.target.value}))}/></div>
  <div style={{display:"flex",gap:8}}><button className="btn btn-secondary" onClick={onCancel} style={{flex:1}}>Cancel</button><button className="btn btn-primary" onClick={()=>valid&&onSubmit(form)} disabled={!valid} style={{flex:2}}>{isAdmin?"Book It ğŸ’‹":"Request Booking ğŸ’‹"}</button></div></div>);};
const ApptCard=({appt:a})=>{const svc=SERVICE_TYPES.find(s=>s.id===a.service);const ts=TIME_SLOTS.find(t=>t.id===a.time_slot);const vb=VIBES.find(v=>v.id===a.vibe);const ds=new Date(a.date+"T12:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"});const sl={upcoming:"Upcoming",cancelled:"Cancelled",pending:"Pending",rejected:"Rejected"}[a.status]||"";const bc=a.status==="pending"?activeTheme.warning:a.status==="rejected"?activeTheme.danger:activeTheme.primary;
  return(<div className={`card appointment-card ${a.status==="cancelled"||a.status==="rejected"?"cancelled":""}`} style={{borderLeftColor:bc}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:6}}><div><div style={{display:"flex",alignItems:"center",gap:6,marginBottom:2}}><span style={{fontSize:"1.05rem"}}>{svc?.icon}</span><span style={{fontWeight:700,fontSize:"0.92rem"}}>{svc?.label}</span></div><div style={{color:activeTheme.textMuted,fontSize:"0.8rem"}}>{ds} â€¢ {ts?.icon} {ts?.label}</div></div><span className={`badge badge-${a.status}`}>{sl}</span></div>
  <div style={{display:"flex",flexWrap:"wrap",gap:4,marginBottom:5}}><span className="chip selected" style={{padding:"3px 8px",fontSize:"0.7rem"}}>{vb?.icon} {vb?.label}</span>{a.kinky_extras?.map(kId=>{const k=KINKY_EXTRAS.find(x=>x.id===kId);return k?<span key={kId} className="chip" style={{padding:"3px 8px",fontSize:"0.7rem",borderColor:activeTheme.warning+"44",color:activeTheme.warning}}>{k.icon} {k.label}</span>:null;})}{a.addons?.map(aId=>{const ad=ADDON_OPTIONS.find(x=>x.id===aId);return ad?<span key={aId} className="chip" style={{padding:"3px 8px",fontSize:"0.7rem"}}>{ad.icon} {ad.label}</span>:null;})}</div>
  {a.notes&&<p style={{fontSize:"0.8rem",color:activeTheme.textMuted,fontStyle:"italic",marginBottom:5}}>"{a.notes}"</p>}
  {a.cancel_comment&&<p style={{fontSize:"0.75rem",color:activeTheme.danger,marginBottom:5}}>Note: {a.cancel_comment}</p>}
  {a.admin_response&&<p style={{fontSize:"0.75rem",color:a.status==="rejected"?activeTheme.danger:activeTheme.success,marginBottom:5}}>ğŸ‘‘ {a.responded_by}: {a.admin_response}</p>}
  {a.status==="pending"&&isAdmin&&<div style={{display:"flex",gap:6,marginTop:5}}><button className="btn btn-sm" style={{flex:1,background:`${activeTheme.success}22`,color:activeTheme.success,border:`1px solid ${activeTheme.success}33`}} onClick={()=>setShowModal({type:"approveAppt",apptId:a.id})}>âœ“ Accept</button><button className="btn btn-danger btn-sm" style={{flex:1}} onClick={()=>setShowModal({type:"rejectAppt",apptId:a.id})}>âœ— Reject</button></div>}
  {a.status==="pending"&&!isAdmin&&<p style={{fontSize:"0.72rem",color:activeTheme.warning,marginTop:4}}>â³ Waiting...</p>}
  {a.status==="upcoming"&&<div style={{display:"flex",gap:6,marginTop:5}}>{!isAdmin&&<button className="btn btn-danger btn-sm" onClick={()=>cancelAppt(a.id)}>Cancel</button>}{isAdmin&&<><button className="btn btn-danger btn-sm" onClick={()=>setShowModal({type:"cancelAppt",apptId:a.id})}>Cancel</button><button className="btn btn-sm" onClick={()=>deleteAppt(a.id)} style={{background:`${activeTheme.danger}11`,color:activeTheme.danger}}>Delete</button></>}</div>}</div>);};
const DateRangeEditor=({ranges,setRanges,label})=>{const[s,setS]=useState("");const[e,setE]=useState("");return(<div style={{marginTop:8}}>{label&&<label>{label}</label>}<div className="form-row" style={{marginBottom:6}}><div><label style={{fontSize:"0.68rem"}}>From</label><input type="date" value={s} onChange={ev=>setS(ev.target.value)}/></div><div><label style={{fontSize:"0.68rem"}}>To</label><input type="date" value={e} min={s} onChange={ev=>setE(ev.target.value)}/></div></div><button className="btn btn-secondary btn-sm" disabled={!s} onClick={()=>{if(s){setRanges(p=>[...p,{id:gid(),start:s,end:e||s}]);setS("");setE("");}}}>+ Add</button><div style={{marginTop:6,display:"flex",flexWrap:"wrap"}}>{ranges.map(r=><span key={r.id} className="dr-pill">{r.start}{r.end&&r.end!==r.start?` â†’ ${r.end}`:""}<button onClick={()=>setRanges(p=>p.filter(x=>x.id!==r.id))}>âœ•</button></span>)}</div></div>);};
const MsgsPage=()=>{const[txt,setTxt]=useState("");const[search,setSearch]=useState("");const[nE,setNE]=useState(false);const[nT,setNT]=useState(false);const[nA,setNA]=useState(true);const hl=search.trim().toLowerCase();useEffect(()=>{chatEndRef.current?.scrollIntoView({behavior:"smooth"});},[messages]);const send=()=>{if(!txt.trim())return;sendMsg(txt.trim(),{email:nE,sms:nT,app:nA});setTxt("");};const shown=hl?messages.filter(m=>m.text.toLowerCase().includes(hl)):messages;
  return(<div className="chat-container"><h2 className="section-title stagger-1">Messages</h2><p className="section-subtitle stagger-1">Private DMs ğŸ’Œ</p><div style={{paddingBottom:8}} className="stagger-2"><input type="text" placeholder="ğŸ” Search..." value={search} onChange={e=>setSearch(e.target.value)} style={{fontSize:"0.83rem",padding:"8px 11px"}}/></div>
  <div className="chat-messages">{shown.map(m=>{const sent=m.from_user===session.user.id;const t=new Date(m.created_at).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"});return(<div key={m.id} className={`chat-msg ${sent?"sent":"received"}`}>{m.text}<span className="msg-time">{t}</span></div>);})}<div ref={chatEndRef}/></div>
  <div className="chat-input-area"><div className="chat-notify-row"><label><input type="checkbox" checked={nE} onChange={()=>setNE(!nE)}/>Email</label><label><input type="checkbox" checked={nT} onChange={()=>setNT(!nT)}/>Text</label><label><input type="checkbox" checked={nA} onChange={()=>setNA(!nA)}/>App</label></div><div className="chat-input-row"><input type="text" placeholder="Type a message..." value={txt} onChange={e=>setTxt(e.target.value)} onKeyDown={e=>e.key==="Enter"&&send()}/><button className="btn btn-primary btn-sm" onClick={send} disabled={!txt.trim()}>Send</button></div></div></div>);};
// Folder card component
const FolderCard=({folder,onClick})=>{const fp=scopedPhotos.filter(p=>p.folder_id===folder.id);const prev=fp.length>0?fp[fp.length-1]:null;const fc=folder.color||activeTheme.primary;const iconUrl=folder.icon_type==="image"?getFolderIconUrl(folder):"";
  return(<div onClick={onClick} style={{background:activeTheme.card,border:`1px solid ${activeTheme.cardBorder}`,borderRadius:14,overflow:"hidden",cursor:"pointer",transition:"all 0.25s ease",position:"relative"}}>
  <div style={{aspectRatio:"1",background:iconUrl&&folder.icon_size==="fill"?`url(${iconUrl}) center/cover`:prev?.url?`url(${prev.url}) center/cover`:fc+"88",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"}}>
    {!prev?.url&&!iconUrl&&<span style={{fontSize:"2rem",opacity:0.9}}>{folder.emoji||"ğŸ“"}</span>}
    {!prev?.url&&iconUrl&&folder.icon_size==="center"&&<img src={iconUrl} style={{width:"55%",height:"55%",objectFit:"contain",borderRadius:6}} alt=""/>}
    {prev?.url&&<div style={{position:"absolute",inset:0,background:"linear-gradient(to top,rgba(0,0,0,0.65) 0%,transparent 50%)"}}/>}
    <div style={{position:"absolute",top:6,right:6,background:fc+"dd",borderRadius:10,padding:"1px 7px",fontSize:"0.58rem",fontWeight:700,color:"white",zIndex:1}}>{fp.length}</div>
  </div>
  <div style={{padding:"7px 8px",textAlign:"center"}}><div style={{fontWeight:700,fontSize:"0.74rem",color:activeTheme.text,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{folder.name}</div></div>
  <div style={{position:"absolute",top:6,left:6,width:8,height:8,borderRadius:"50%",background:fc,boxShadow:`0 0 6px ${fc}88`}}/></div>);};
const renderPage=()=>{switch(page){
case "home":return(<div key="home"><div className="stagger-1"><h2 className="section-title">{isAdmin?`${profile.display_name}'s Dashboard`:`Hey, ${profile.display_name}`}</h2><p className="section-subtitle">{isAdmin?"Manage appointments ğŸ”¥":"Ready for fun? ğŸ˜"}</p></div>
  <div className="stats-row stagger-2"><div className="stat-card"><div className="stat-number">{upcomingAppts.length}</div><div className="stat-label">Upcoming</div></div><div className="stat-card"><div className="stat-number" style={pendingAppts.length>0?{color:activeTheme.warning}:{}}>{pendingAppts.length}</div><div className="stat-label">Pending</div></div><div className="stat-card"><div className="stat-number">{appointments.length}</div><div className="stat-label">Total</div></div></div>
  <div className="stagger-3" style={{marginBottom:12}}><button className="btn btn-primary btn-block" onClick={()=>setPage("book")}>ğŸ“… Book New Appointment</button></div>
  {isAdmin&&pendingAppts.length>0&&<div className="stagger-4" style={{marginBottom:12}}><h3 className="card-title" style={{color:activeTheme.warning}}>â³ Pending</h3>{pendingAppts.map(a=><ApptCard key={a.id} appt={a}/>)}</div>}
  {!isAdmin&&pendingAppts.length>0&&<div className="stagger-4" style={{marginBottom:12}}><h3 className="card-title" style={{color:activeTheme.warning}}>â³ Awaiting</h3>{pendingAppts.map(a=><ApptCard key={a.id} appt={a}/>)}</div>}
  <div className="stagger-5"><h3 className="card-title">ğŸ”¥ Upcoming</h3>{upcomingAppts.length===0?<div className="empty-state"><div className="empty-icon">ğŸ“­</div><p>No upcoming</p></div>:upcomingAppts.slice(0,5).map(a=><ApptCard key={a.id} appt={a}/>)}</div></div>);
case "book":return(<div key="book"><h2 className="section-title stagger-1">New Booking</h2><p className="section-subtitle stagger-1">Schedule something ğŸ˜</p><BookingForm onSubmit={addAppt} onCancel={()=>setPage("home")}/></div>);
case "history":{const total=appointments.length;let f=[...appointments].sort((a,b)=>new Date(b.date)-new Date(a.date));if(historyFilterFrom)f=f.filter(a=>a.date>=historyFilterFrom);if(historyFilterTo)f=f.filter(a=>a.date<=historyFilterTo);if(historyFilters.service.length)f=f.filter(a=>historyFilters.service.includes(a.service));if(historyFilters.vibe.length)f=f.filter(a=>historyFilters.vibe.includes(a.vibe));if(historyFilters.status.length)f=f.filter(a=>historyFilters.status.includes(a.status));if(historyFilters.addons.length)f=f.filter(a=>historyFilters.addons.some(ad=>a.addons?.includes(ad)));if(historyFilters.kinkyExtras.length)f=f.filter(a=>historyFilters.kinkyExtras.some(ke=>a.kinky_extras?.includes(ke)));const hs=historySearch.trim().toLowerCase();if(hs)f=f.filter(a=>[a.notes||"",a.cancel_comment||"",a.admin_response||""].join(" ").toLowerCase().includes(hs));const fc=f.length;const any=historyFilterFrom||historyFilterTo||historyFilters.service.length||historyFilters.vibe.length||historyFilters.status.length||historyFilters.addons.length||historyFilters.kinkyExtras.length||hs;const clearAll=()=>{setHistoryFilterFrom("");setHistoryFilterTo("");setHistorySearch("");setHistoryFilters({service:[],vibe:[],status:[],addons:[],kinkyExtras:[]});};const afc=[historyFilters.service.length>0,historyFilters.vibe.length>0,historyFilters.status.length>0,historyFilters.addons.length>0,historyFilters.kinkyExtras.length>0,!!historyFilterFrom||!!historyFilterTo].filter(Boolean).length;
  return(<div key="hist"><div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:4}}><div className="stagger-1"><h2 className="section-title">History</h2><p className="section-subtitle" style={{marginBottom:0}}>All appointments ğŸ’«</p></div><div className="stagger-1" style={{textAlign:"right"}}><div style={{fontFamily:"'Playfair Display',serif",fontSize:"1.5rem",fontWeight:800,color:activeTheme.primary}}>{any?fc:total}</div><div style={{fontSize:"0.65rem",color:activeTheme.textMuted,fontWeight:600}}>{any?`of ${total}`:""} appts</div></div></div>
  <div className="stagger-2" style={{marginBottom:8,position:"relative",display:"flex",alignItems:"center"}}><input type="text" placeholder="ğŸ” Search..." value={historySearch} onChange={e=>setHistorySearch(e.target.value)} style={{fontSize:"0.83rem",padding:"8px 40px 8px 11px"}}/><button onClick={()=>setShowModal({type:"historyFilter"})} style={{position:"absolute",right:4,top:"50%",transform:"translateY(-50%)",background:afc>0?activeTheme.primaryGlow:"transparent",border:"none",borderRadius:8,width:32,height:32,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"1.05rem"}}><span>âš™ï¸</span>{afc>0&&<span style={{position:"absolute",top:1,right:1,width:14,height:14,borderRadius:"50%",background:activeTheme.primary,color:"white",fontSize:"0.52rem",fontWeight:800,display:"flex",alignItems:"center",justifyContent:"center"}}>{afc}</span>}</button></div>
  {any&&<div className="stagger-2" style={{marginBottom:10}}><button className="btn btn-sm btn-danger" onClick={clearAll}>âœ• Clear All</button></div>}
  {f.length===0?<div className="empty-state stagger-3"><div className="empty-icon">ğŸ“‹</div><p>None found</p></div>:<div className="stagger-3">{f.map(a=><ApptCard key={a.id} appt={a}/>)}</div>}</div>);}
case "vault":{
  const currentFld=openFolder?photoFolders.find(f=>f.id===openFolder):null;
  const fldPhotos=openFolder?photos.filter(p=>p.folder_id===openFolder):[];
  // Inside folder view
  if(openFolder&&currentFld){
    const iconUrl=currentFld.icon_type==="image"?getFolderIconUrl(currentFld):"";
    return(<div key="vault-in"><div style={{display:"flex",alignItems:"center",gap:8,marginBottom:6}} className="stagger-1">
      <button className="btn btn-secondary btn-sm" onClick={()=>setOpenFolder(null)} style={{padding:"5px 10px",fontSize:"1rem",lineHeight:1}}>â†</button>
      <div style={{flex:1}}><input type="text" value={currentFld.name} onChange={e=>updateFolder(openFolder,{name:e.target.value})} style={{fontFamily:"'Playfair Display',serif",fontSize:"1.15rem",fontWeight:700,background:"transparent",border:"none",borderBottom:`1px solid ${activeTheme.cardBorder}`,borderRadius:0,padding:"4px 0",color:activeTheme.text}}/></div>
      <input type="color" value={currentFld.color||activeTheme.primary} onChange={e=>updateFolder(openFolder,{color:e.target.value})} style={{width:28,height:28,padding:2,borderRadius:6}}/>
    </div>
    {/* Emoji / Icon / Size controls */}
    <div className="stagger-2" style={{display:"flex",gap:6,alignItems:"center",marginBottom:8,flexWrap:"wrap"}}>
      <button className="btn btn-secondary btn-sm" onClick={()=>setShowModal({type:"folderEmoji",folderId:openFolder})}>{currentFld.emoji||"ğŸ“"} Emoji</button>
      <button className="btn btn-secondary btn-sm" onClick={()=>folderIconRef.current?.click()}>ğŸ–¼ï¸ Icon</button>
      <input ref={folderIconRef} type="file" accept="image/*" style={{display:"none"}} onChange={e=>{const f=e.target.files?.[0];if(f)uploadFolderIcon(f,openFolder);e.target.value="";}}/>
      {currentFld.icon_type==="image"&&<><button className={`btn btn-sm ${currentFld.icon_size==="center"?"btn-primary":"btn-secondary"}`} onClick={()=>updateFolder(openFolder,{icon_size:"center"})}>Center</button><button className={`btn btn-sm ${currentFld.icon_size==="fill"?"btn-primary":"btn-secondary"}`} onClick={()=>updateFolder(openFolder,{icon_size:"fill"})}>Fill</button><button className="btn btn-sm btn-danger" onClick={()=>updateFolder(openFolder,{icon_type:"emoji",icon_image_path:""})}>âœ•</button></>}
    </div>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}} className="stagger-2"><span style={{fontSize:"0.75rem",color:activeTheme.textMuted,fontWeight:600}}>{fldPhotos.length} item{fldPhotos.length!==1?"s":""}</span><div style={{display:"flex",gap:5}}><button className="btn btn-danger btn-sm" onClick={()=>deleteFolder(openFolder)}>ğŸ—‘ï¸</button><button className="btn btn-primary btn-sm" onClick={()=>photoInputRef.current?.click()}>+ Add</button></div><input ref={photoInputRef} type="file" accept="image/*,video/*" multiple style={{display:"none"}} onChange={handlePhotoInput}/></div>
    {fldPhotos.length===0?<div className="empty-state stagger-3"><div className="empty-icon">ğŸ“¸</div><p>Empty</p></div>:
    <div className="photo-grid stagger-3">{fldPhotos.map(p=><div key={p.id} className="photo-thumb">{p.file_type==="video"?<video src={p.url} onClick={()=>setLightboxPhoto(p)}/>:<img src={p.url} alt="" onClick={()=>setLightboxPhoto(p)}/>}<button className="del-btn" onClick={e=>{e.stopPropagation();deletePhoto(p);}}>âœ•</button></div>)}</div>}</div>);}
  // Folder grid view
  return(<div key="vault"><div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:8}}><div className="stagger-1"><h2 className="section-title">Photo Vault</h2><p className="section-subtitle" style={{marginBottom:0}}>Private collection ğŸ”’</p></div><button className="btn btn-primary btn-sm stagger-2" onClick={()=>setShowModal({type:"newFolder"})}>+ Folder</button></div>
  <div className="tab-bar stagger-2"><button className={`tab-btn ${vaultTab==="shared"?"active":""}`} onClick={()=>setVaultTab("shared")}>ğŸ”— Shared</button><button className={`tab-btn ${vaultTab==="personal"?"active":""}`} onClick={()=>setVaultTab("personal")}>ğŸ”’ Personal</button></div>
  <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:10}} className="stagger-3">
    <div onClick={()=>setPage("vault-all")} style={{background:activeTheme.card,border:`1px solid ${activeTheme.cardBorder}`,borderRadius:14,overflow:"hidden",cursor:"pointer"}}><div style={{aspectRatio:"1",background:activeTheme.primary+"88",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"}}><span style={{fontSize:"2rem",opacity:0.9}}>ğŸ“¸</span><div style={{position:"absolute",top:6,right:6,background:activeTheme.primary+"dd",borderRadius:10,padding:"1px 7px",fontSize:"0.58rem",fontWeight:700,color:"white"}}>{scopedPhotos.length}</div></div><div style={{padding:"7px 8px",textAlign:"center"}}><div style={{fontWeight:700,fontSize:"0.74rem",color:activeTheme.text}}>All {vaultTab==="personal"?"Private":""}</div></div></div>
    {scopedFolders.map(fld=><FolderCard key={fld.id} folder={fld} onClick={()=>setOpenFolder(fld.id)}/>)}
  </div></div>);}
case "vault-all":return(<div key="va"><div style={{display:"flex",alignItems:"center",gap:8,marginBottom:10}} className="stagger-1"><button className="btn btn-secondary btn-sm" onClick={()=>setPage("vault")} style={{padding:"5px 10px",fontSize:"1rem",lineHeight:1}}>â†</button><h2 className="section-title" style={{marginBottom:0}}>All {vaultTab==="personal"?"Private ":""} Photos</h2><div style={{flex:1}}/><button className="btn btn-primary btn-sm" onClick={()=>photoInputRef.current?.click()}>+ Add</button><input ref={photoInputRef} type="file" accept="image/*,video/*" multiple style={{display:"none"}} onChange={handlePhotoInput}/></div>
  <p className="section-subtitle stagger-1">{scopedPhotos.length} item{scopedPhotos.length!==1?"s":""}</p>
  {scopedPhotos.length===0?<div className="empty-state stagger-2"><div className="empty-icon">ğŸ“¸</div><p>Empty</p></div>:
  <div className="photo-grid stagger-2">{scopedPhotos.map(p=><div key={p.id} className="photo-thumb">{p.file_type==="video"?<video src={p.url} onClick={()=>setLightboxPhoto(p)}/>:<img src={p.url} alt="" onClick={()=>setLightboxPhoto(p)}/>}<button className="del-btn" onClick={e=>{e.stopPropagation();deletePhoto(p);}}>âœ•</button></div>)}</div>}</div>);
case "messages":return <MsgsPage/>;
case "profile":{const rdr=settings.restricted_date_ranges||[];const adr=settings.anal_date_ranges||[];
  return(<div key="prof"><h2 className="section-title stagger-1">Settings</h2><p className="section-subtitle stagger-1">Customize âœ¨</p>
  <div className="card stagger-2"><div className="profile-avatar" onClick={()=>profileInputRef.current?.click()}>{profile.photo_url?<img src={profile.photo_url} alt=""/>:"ğŸ˜˜"}</div><input ref={profileInputRef} type="file" accept="image/*" style={{display:"none"}} onChange={e=>{const f=e.target.files?.[0];if(f)uploadAvatar(f);}}/><h3 style={{textAlign:"center",fontFamily:"'Playfair Display',serif",fontSize:"1.1rem"}}>{profile.display_name}</h3><p style={{textAlign:"center",color:activeTheme.textMuted,fontSize:"0.8rem"}}>{session.user.email} â€¢ {isAdmin?"ğŸ‘‘":"ğŸ’"}</p><button className="btn btn-secondary btn-sm btn-block" style={{marginTop:8}} onClick={()=>setShowModal({type:"editSelf"})}>Edit Account</button></div>
  {/* App Personalization */}
  <div className="card stagger-3"><h3 className="card-title">ğŸ“± App Personalization</h3>
    <div className="form-group"><label>App Name (Home Screen)</label><input type="text" value={prefs.app_name} onChange={e=>updatePrefs({app_name:e.target.value})} placeholder="ğŸ’‹"/></div>
    <div className="form-group"><label>Background Image</label>
      {bgImageUrl&&<div style={{marginBottom:8,borderRadius:10,overflow:"hidden",height:80}}><img src={bgImageUrl} style={{width:"100%",height:"100%",objectFit:"cover"}} alt=""/></div>}
      <div style={{display:"flex",gap:6,flexWrap:"wrap"}}>{custImages.map(ci=><div key={ci.id} className={`img-gallery-item ${prefs.bg_image_path===ci.storage_path?"sel":""}`} style={{width:52,height:52}} onClick={()=>updatePrefs({bg_image_path:prefs.bg_image_path===ci.storage_path?"":ci.storage_path})}><img src={ci.url} alt=""/></div>)}</div>
      {bgImageUrl&&<button className="btn btn-sm btn-secondary" style={{marginTop:6}} onClick={()=>updatePrefs({bg_image_path:""})}>Remove BG</button>}
    </div>
    <div className="form-group"><label>App Icon Image</label>
      <div style={{display:"flex",gap:6,flexWrap:"wrap"}}>{custImages.map(ci=><div key={ci.id} className={`img-gallery-item ${prefs.app_icon_image_path===ci.storage_path?"sel":""}`} style={{width:52,height:52,borderRadius:12}} onClick={()=>updatePrefs({app_icon_type:"image",app_icon_image_path:ci.storage_path})}><img src={ci.url} alt="" style={{borderRadius:10}}/></div>)}</div>
      {prefs.app_icon_type==="image"&&<button className="btn btn-sm btn-secondary" style={{marginTop:6}} onClick={()=>updatePrefs({app_icon_type:"theme",app_icon_image_path:""})}>Use Theme Icon</button>}
    </div>
  </div>
  {/* Image Library */}
  <div className="card stagger-4"><h3 className="card-title">ğŸ–¼ï¸ Image Library</h3>
    <p style={{fontSize:"0.72rem",color:activeTheme.textMuted,marginBottom:8}}>Upload images for backgrounds, app icons, or folder icons</p>
    <button className="btn btn-secondary btn-sm" style={{marginBottom:10}} onClick={()=>custImgRef.current?.click()}>+ Upload Images</button>
    <input ref={custImgRef} type="file" accept="image/*" multiple style={{display:"none"}} onChange={handleCustImgInput}/>
    <div className="img-gallery">{custImages.map(ci=><div key={ci.id} className="img-gallery-item"><img src={ci.url} alt={ci.label}/>
      {(isAdmin||(!ci.is_preset&&ci.uploaded_by===session.user.id))&&<button className="del-x" onClick={e=>{e.stopPropagation();deleteCustImg(ci);}}>âœ•</button>}
      {ci.is_preset&&<div style={{position:"absolute",bottom:3,left:3,background:"rgba(0,0,0,0.6)",borderRadius:4,padding:"1px 4px",fontSize:"0.5rem",color:"white"}}>Preset</div>}
    </div>)}</div>
  </div>
  {/* Theme */}
  <div className="card stagger-4"><h3 className="card-title">ğŸ¨ Theme</h3>
    {Object.entries(THEMES).map(([k,t])=><div key={k} className={`theme-option ${currentTheme===k?"selected":""}`} onClick={()=>updateSettings({current_theme:k,custom_colors:null})}><div className="theme-dot" style={{background:`linear-gradient(135deg,${t.primary},${t.secondary})`}}/><div><div style={{fontWeight:600,fontSize:"0.85rem"}}>{t.emoji} {t.name}</div></div></div>)}
    <div style={{marginTop:10,padding:10,background:activeTheme.surface,borderRadius:10}}><div style={{fontWeight:600,fontSize:"0.82rem",marginBottom:6}}>Custom Colors</div><div style={{display:"flex",gap:10}}><div><label style={{fontSize:"0.68rem"}}>Primary</label><input type="color" value={customColors?.primary||activeTheme.primary} onChange={e=>updateSettings({custom_colors:{...(customColors||{}),primary:e.target.value,secondary:customColors?.secondary||activeTheme.secondary}})}/></div><div><label style={{fontSize:"0.68rem"}}>Secondary</label><input type="color" value={customColors?.secondary||activeTheme.secondary} onChange={e=>updateSettings({custom_colors:{...(customColors||{}),secondary:e.target.value,primary:customColors?.primary||activeTheme.primary}})}/></div>{customColors&&<button className="btn btn-sm btn-secondary" onClick={()=>updateSettings({custom_colors:null})}>Reset</button>}</div></div></div>
  {/* Contact */}
  <div className="card stagger-5"><h3 className="card-title">ğŸ“² Contact</h3><div className="form-group"><label>Email</label><input type="email" value={profile.email||""} onChange={e=>updateProfile({email:e.target.value})}/></div><div className="form-group"><label>Phone</label><input type="tel" value={profile.phone||""} onChange={e=>updateProfile({phone:e.target.value})}/></div></div>
  {/* Admin Controls */}
  {isAdmin&&<div className="card stagger-5"><h3 className="card-title">ğŸ‘‘ {profile.display_name}'s Controls</h3>
    <div className="setting-row"><div><div className="setting-label">Restrict Dates</div><div className="setting-desc">Only allow specific ranges</div></div><Toggle active={settings.restrict_dates} onToggle={()=>updateSettings({restrict_dates:!settings.restrict_dates})}/></div>
    {settings.restrict_dates&&<DateRangeEditor ranges={rdr} setRanges={v=>updateSettings({restricted_date_ranges:v})} label="ğŸ“… Allowed Ranges"/>}
    <div style={{marginTop:12,paddingTop:12,borderTop:`1px solid ${activeTheme.cardBorder}`}}><div className="setting-label">ğŸ‘ Anal Availability</div><DateRangeEditor ranges={adr} setRanges={v=>updateSettings({anal_date_ranges:v})} label=""/></div>
    {partner&&<div style={{marginTop:12,paddingTop:12,borderTop:`1px solid ${activeTheme.cardBorder}`}}><div className="setting-label" style={{marginBottom:5}}>Partner</div><div style={{background:activeTheme.surface,padding:9,borderRadius:9,fontSize:"0.8rem"}}><div><strong>Name:</strong> {partner.display_name}</div><div><strong>Email:</strong> {partner.email||"â€”"}</div></div><button className="btn btn-secondary btn-block btn-sm" style={{marginTop:6}} onClick={()=>setShowModal({type:"editPartner"})}>Edit</button></div>}
  </div>}
  <button className="btn btn-danger btn-block stagger-5" onClick={handleLogout} style={{marginTop:6}}>Sign Out</button></div>);}
default:return null;}};
// Modals
const CancelModal=()=>{const[c,setC]=useState("");if(!showModal||showModal.type!=="cancelAppt")return null;return(<div className="modal-overlay" onClick={()=>setShowModal(null)}><div className="modal-content" onClick={e=>e.stopPropagation()}><h3 className="card-title">Cancel Appointment</h3><div className="form-group"><label>Comment</label><textarea value={c} onChange={e=>setC(e.target.value)}/></div><div style={{display:"flex",gap:8}}><button className="btn btn-secondary" onClick={()=>setShowModal(null)} style={{flex:1}}>Back</button><button className="btn btn-danger" style={{flex:1}} onClick={()=>{cancelAppt(showModal.apptId,c);setShowModal(null);}}>Cancel</button></div></div></div>);};
const ApproveRejectModal=()=>{const[msg,setMsg]=useState("");if(!showModal||!["approveAppt","rejectAppt"].includes(showModal.type))return null;const isA=showModal.type==="approveAppt";const appt=appointments.find(a=>a.id===showModal.apptId);const svc=SERVICE_TYPES.find(s=>s.id===appt?.service);return(<div className="modal-overlay" onClick={()=>setShowModal(null)}><div className="modal-content" onClick={e=>e.stopPropagation()}><h3 className="card-title">{isA?"âœ“ Accept":"âœ— Reject"}</h3>{appt&&<div style={{background:activeTheme.surface,padding:10,borderRadius:10,marginBottom:12,fontSize:"0.82rem"}}><div style={{fontWeight:700}}>{svc?.icon} {svc?.label}</div></div>}<div className="form-group"><label>Message</label><textarea value={msg} onChange={e=>setMsg(e.target.value)}/></div><div style={{display:"flex",gap:8}}><button className="btn btn-secondary" onClick={()=>setShowModal(null)} style={{flex:1}}>Back</button><button className={`btn ${isA?"btn-primary":"btn-danger"}`} style={{flex:1}} onClick={()=>{if(isA)approveAppt(showModal.apptId,msg);else rejectAppt(showModal.apptId,msg);setShowModal(null);}}>{isA?"Accept ğŸ’‹":"Reject"}</button></div></div></div>);};
const EditSelfModal=()=>{const[f,setF]=useState({display_name:profile?.display_name||""});if(!showModal||showModal.type!=="editSelf")return null;return(<div className="modal-overlay" onClick={()=>setShowModal(null)}><div className="modal-content" onClick={e=>e.stopPropagation()}><h3 className="card-title">Edit Account</h3><div className="form-group"><label>Display Name</label><input value={f.display_name} onChange={e=>setF(p=>({...p,display_name:e.target.value}))}/></div><div className="form-group"><label>New Password</label><input type="password" placeholder="Leave blank to keep" value={f.password||""} onChange={e=>setF(p=>({...p,password:e.target.value}))}/></div><div style={{display:"flex",gap:8}}><button className="btn btn-secondary" onClick={()=>setShowModal(null)} style={{flex:1}}>Cancel</button><button className="btn btn-primary" style={{flex:1}} onClick={async()=>{if(f.display_name)await updateProfile({display_name:f.display_name});if(f.password)await sb.auth.updateUser({password:f.password});setShowModal(null);showToast("Updated!");}}>Save</button></div></div></div>);};
const EditPartnerModal=()=>{const[f,setF]=useState({display_name:partner?.display_name||""});if(!showModal||showModal.type!=="editPartner")return null;return(<div className="modal-overlay" onClick={()=>setShowModal(null)}><div className="modal-content" onClick={e=>e.stopPropagation()}><h3 className="card-title">Edit Partner</h3><div className="form-group"><label>Display Name</label><input value={f.display_name} onChange={e=>setF(p=>({...p,display_name:e.target.value}))}/></div><div style={{display:"flex",gap:8}}><button className="btn btn-secondary" onClick={()=>setShowModal(null)} style={{flex:1}}>Cancel</button><button className="btn btn-primary" style={{flex:1}} onClick={()=>{updatePartnerProfile({display_name:f.display_name});setShowModal(null);}}>Save</button></div></div></div>);};
const NewFolderModal=()=>{const[n,setN]=useState("");const[fc,setFc]=useState(activeTheme.primary);const[em,setEm]=useState("ğŸ“");if(!showModal||showModal.type!=="newFolder")return null;const go=()=>{if(n.trim()){createFolder(n.trim(),fc,em,vaultTab);setShowModal(null);}};return(<div className="modal-overlay" onClick={()=>setShowModal(null)}><div className="modal-content" onClick={e=>e.stopPropagation()}><h3 className="card-title">New {vaultTab==="personal"?"Private ":""}Folder</h3><div className="form-group"><label>Name</label><input placeholder="e.g. Date Night ğŸŒ™" value={n} onChange={e=>setN(e.target.value)} onKeyDown={e=>e.key==="Enter"&&go()}/></div><div className="form-group"><label>Emoji</label><div className="emoji-grid">{COMMON_EMOJI.map(e=><button key={e} className={`emoji-btn ${em===e?"sel":""}`} onClick={()=>setEm(e)}>{e}</button>)}</div></div><div className="form-group"><label>Color</label><div style={{display:"flex",alignItems:"center",gap:10}}><input type="color" value={fc} onChange={e=>setFc(e.target.value)}/><div style={{flex:1,height:28,borderRadius:8,background:fc+"88",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.2rem"}}>{em}</div></div></div><div style={{display:"flex",gap:8}}><button className="btn btn-secondary" onClick={()=>setShowModal(null)} style={{flex:1}}>Cancel</button><button className="btn btn-primary" style={{flex:1}} disabled={!n.trim()} onClick={go}>Create</button></div></div></div>);};
const FolderEmojiModal=()=>{const fld=showModal?.folderId?photoFolders.find(f=>f.id===showModal.folderId):null;const[em,setEm]=useState(fld?.emoji||"ğŸ“");if(!showModal||showModal.type!=="folderEmoji"||!fld)return null;return(<div className="modal-overlay" onClick={()=>setShowModal(null)}><div className="modal-content" onClick={e=>e.stopPropagation()}><h3 className="card-title">Folder Emoji</h3><div className="emoji-grid">{COMMON_EMOJI.map(e=><button key={e} className={`emoji-btn ${em===e?"sel":""}`} onClick={()=>setEm(e)}>{e}</button>)}</div><div style={{display:"flex",gap:8,marginTop:12}}><button className="btn btn-secondary" onClick={()=>setShowModal(null)} style={{flex:1}}>Cancel</button><button className="btn btn-primary" style={{flex:1}} onClick={()=>{updateFolder(showModal.folderId,{emoji:em,icon_type:"emoji"});setShowModal(null);}}>Save</button></div></div></div>);};
const HistoryFilterModal=()=>{const[f,setF]=useState(historyFilters);const[dfrom,setDfrom]=useState(historyFilterFrom);const[dto,setDto]=useState(historyFilterTo);if(!showModal||showModal.type!=="historyFilter")return null;const tg=(k,id)=>setF(p=>({...p,[k]:p[k].includes(id)?p[k].filter(x=>x!==id):[...p[k],id]}));const STS=[{id:"upcoming",label:"Upcoming",icon:"âœ…"},{id:"pending",label:"Pending",icon:"â³"},{id:"cancelled",label:"Cancelled",icon:"âŒ"},{id:"rejected",label:"Rejected",icon:"ğŸš«"}];const apply=()=>{setHistoryFilters(f);setHistoryFilterFrom(dfrom);setHistoryFilterTo(dto);setShowModal(null);};const clr=()=>{const e={service:[],vibe:[],status:[],addons:[],kinkyExtras:[]};setF(e);setDfrom("");setDto("");setHistoryFilters(e);setHistoryFilterFrom("");setHistoryFilterTo("");};
  return(<div className="modal-overlay" onClick={()=>setShowModal(null)}><div className="modal-content" onClick={e=>e.stopPropagation()}><h3 className="card-title">ğŸ›ï¸ Filters</h3>
  <div className="form-group"><label>ğŸ“… Date</label><div className="form-row"><div><label style={{fontSize:"0.66rem"}}>From</label><input type="date" value={dfrom} onChange={e=>setDfrom(e.target.value)}/></div><div><label style={{fontSize:"0.66rem"}}>To</label><input type="date" value={dto} onChange={e=>setDto(e.target.value)}/></div></div></div>
  <div className="form-group"><label>ğŸ“Œ Status</label><div className="chip-grid">{STS.map(s=><div key={s.id} className={`chip ${f.status.includes(s.id)?"selected":""}`} onClick={()=>tg("status",s.id)}><span>{s.icon}</span><span>{s.label}</span></div>)}</div></div>
  <div className="form-group"><label>ğŸ’‹ Service</label><div className="chip-grid">{SERVICE_TYPES.map(s=><div key={s.id} className={`chip ${f.service.includes(s.id)?"selected":""}`} onClick={()=>tg("service",s.id)}><span>{s.icon}</span><span>{s.label}</span></div>)}</div></div>
  <div className="form-group"><label>ğŸ­ Vibe</label><div className="chip-grid">{VIBES.map(v=><div key={v.id} className={`chip ${f.vibe.includes(v.id)?"selected":""}`} onClick={()=>tg("vibe",v.id)}><span>{v.icon}</span><span>{v.label}</span></div>)}</div></div>
  <div className="form-group"><label>âœ¨ Add-ons</label><div className="chip-grid">{ADDON_OPTIONS.map(a=><div key={a.id} className={`chip ${f.addons.includes(a.id)?"selected":""}`} onClick={()=>tg("addons",a.id)}><span>{a.icon}</span><span>{a.label}</span></div>)}</div></div>
  <div className="form-group"><label>ğŸ˜ˆ Kinky Extras</label><div className="chip-grid">{KINKY_EXTRAS.map(k=><div key={k.id} className={`chip ${f.kinkyExtras.includes(k.id)?"selected":""}`} onClick={()=>tg("kinkyExtras",k.id)}><span>{k.icon}</span><span>{k.label}</span></div>)}</div></div>
  <div style={{display:"flex",gap:8,marginTop:8}}><button className="btn btn-secondary" onClick={clr} style={{flex:1}}>Clear</button><button className="btn btn-primary" onClick={apply} style={{flex:2}}>Apply</button></div></div></div>);};
// Nav & Main Return
const navItems=[{id:"home",icon:"ğŸ ",label:"Home"},{id:"book",icon:"ğŸ“…",label:"Book"},{id:"history",icon:"ğŸ“‹",label:"History"},{id:"vault",icon:"ğŸ“¸",label:"Vault"},{id:"messages",icon:"ğŸ’¬",label:"DMs"},{id:"profile",icon:"âš™ï¸",label:"Settings"}];
const bgStyle=bgImageUrl?{backgroundImage:`url(${bgImageUrl})`,backgroundSize:"cover",backgroundPosition:"center"}:{};
return(<div className="app-container" style={bgStyle}><FloatingHearts/>
  <header className="header"><h1>Book Me, Baby ğŸ’‹</h1><div className="header-right"><button className="header-msg-btn" onClick={()=>setPage("messages")}>ğŸ’¬{unreadMsgs>0&&<span className="msg-dot"/>}</button><span style={{fontSize:"0.76rem",color:activeTheme.textMuted}}>{isAdmin?"ğŸ‘‘":"ğŸ’"} {profile?.display_name}</span></div></header>
  <main className="main-content">{renderPage()}</main>
  <nav className="bottom-nav">{navItems.map(item=><button key={item.id} className={`nav-item ${page===item.id||(item.id==="vault"&&(page==="vault-all"))?"active":""}`} onClick={()=>{if(item.id==="vault")setOpenFolder(null);setPage(item.id);}}><span className="nav-icon">{item.icon}</span>{item.label}{item.id==="messages"&&unreadMsgs>0&&<span className="nav-dot"/>}</button>)}</nav>
  <CancelModal/><ApproveRejectModal/><EditSelfModal/><EditPartnerModal/><NewFolderModal/><FolderEmojiModal/><HistoryFilterModal/>
  {lightboxPhoto&&<div className="lightbox" onClick={()=>setLightboxPhoto(null)}><button className="lightbox-close" onClick={()=>setLightboxPhoto(null)}>âœ•</button>{lightboxPhoto.file_type==="video"?<video src={lightboxPhoto.url} controls autoPlay style={{maxWidth:"95vw",maxHeight:"90vh"}}/>:<img src={lightboxPhoto.url} alt=""/>}</div>}
  {toast&&<div className={`toast toast-${toast.type}`}>{toast.msg}</div>}
</div>);}
ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
